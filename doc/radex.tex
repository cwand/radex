\documentclass[a4paper,article]{memoir}

% Pakker, der skal bruges sideopsÃ¦tning, billeder m.m.
\usepackage[latin1]{inputenc}
\usepackage[danish]{babel}
%\renewcommand\danishhyphenmins{22}
\usepackage[T1]{fontenc}
\usepackage[margin=3cm]{geometry}
\usepackage{graphicx}
\usepackage{xspace}
\usepackage{color}
\usepackage{array,booktabs}
\usepackage{url}
\usepackage{csquotes}

% Matematik og symboler
\usepackage{amsmath,amssymb}
\usepackage{bm}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage{listings}
\usepackage{verbatim}

% Fysik pakker
\usepackage{physics}
\usepackage{siunitx}
\usepackage{isotope}

% Pakke der kan lave rette-noter i margin
\usepackage[draft,danish]{fixme}

\newcommand{\radex}{\emph{Radex}}

% ====================================================================
% HUSK AT Ã†NDRE TITEL OG FORFATTER
\geometry{headheight=1cm}
\title{Radex} 	% Dokumentes Titel
\author{Christian Walther Andersen}		% Dokumentets forfatter
%%% \date{i dag}		% Her kan datoen indsÃ¦ttes, men udelades kommandoen indsÃ¦tter den altid dags dato
% ====================================================================

\begin{document}
	
\setlength{\parindent}{0pt}

\maketitle
\fancybreak{$*\quad*\quad*$}
\vspace{5mm}

% Dokumentet begynder her

\section*{Om Radex}

\radex{} anvendes til at detektere tilstedeværelsen af isotopen 
\isotope[223]{Ra}.
Det tiltænkte brugsscenarie er, at en mængde af affald, tøj e.l., der har været
i nærkontakt med \isotope[223]{Ra}, skal sikres, inden det smides ud, 
genanvendes e.l. Affaldet scannes med et gamma-kamera, og billedet, 
der også indeholder det målte spektrum i dicom-format, analyseres for spor af 
\isotope[223]{Ra}. Det er denne sidste opgave, der kan klares af \radex{}.


\section*{Download og installation}

Kildekoden kan downloades fra GitHub: \url{https://github.com/cwand/radex}. 
\radex{} er skrevet i Python og kan bruges uden installation. Der er dog et par 
variable, der skal angives i kildekoden, inden programmet er helt klar til at 
køre.

\subsection*{Indstilling af filstier}

\radex{} kigger efter dicom-billeder i en filsti, der er angivet i filen 
\texttt{main.py}. Filstierne er angivet tæt på toppen af filen. Variablen 
\texttt{pardir} angiver hvor \radex{} skal kigge efter dicom-filer. \radex{} 
leder i undermapper efter alle filer med filendelsen \texttt{.dcm}. Også 
baggrundsmålinger skal ligge i denne filsti.

Variablen \texttt{archdir} angiver, hvor \radex{} lægger dicom-filerne, når den 
er færdig med analysen. Når analysen er færdig flyttes indholdet af 
\texttt{pardir}-mappen til \texttt{archdir} (man kan vælge dette fra i 
slutningen af analysen, hvis dette ikke ønskes).

\subsection*{Installation}

Hvis man ønsker at installere \radex{}, fx hvis programmet skal bruges på en 
arbejdsstation, der ikke har Python installeret, kan dette gøres ved brug af 
Python-modulet \texttt{pyinstaller}:

\begin{verbatim}
	>>> pyinstaller main.spec
\end{verbatim}

Når installationen er fuldført findes en ny mappe med navnet \texttt{dist}, der 
indeholder alt, der er nødvendigt for at køre programmet. Denne mappe kan så 
kopieres over på den tiltænkte arbejdsstation, og programmet kan køres derfra.


\section*{Brug af programmet}

BESKRIVELSE AF FØLSOMHED

Når programmet starter, vil den først lede efter dicom-filer i den mappe, der 
er blevet angivet efter beskrivelsen ovenfor. Filerne samles efter dicom-taggen 
\emph{Series description}. Det er altså vigtigt at forskellige målinger 
navngives forskelligt. Programmet vil derefter bede brugeren om at specificere 
en serie som baggrundsmåling, og denne vil blive brugt på alle de resterende 
serier som baggrund. Ønsker man at anvende forskellige baggrunde på forskellige 
målinger skal man altså køre programmet én gang for hver baggrund.

Når baggrunden er valgt vil programmet give brugeren information om følsomheden 
(i enheder af $\si{cps/Bq}$) samt \emph{Minimum Detectable Activity}, eller 
MDA, i enheder af $\si{Bq}$.

Derefter går programmet gennem alle serier den kan finde (ud over 
baggrundsserien) i de filer, der er givet som input. For hver serie 
rapporteres, om der bliver registreret aktivitet, samt hvornår aktiviteten kan 
forventes at være nået under et acceptabelt niveau ($300\si{Bq}$ som 
udgangspunkt). Hvis der bliver fundet aktivitet kan man vælge at logge 
registreringen i et medfølgende Excel-dokument. Når alle serierne er analyseret 
afslutter programmet med at spørge brugeren, om målingerne skal arkiveres. 
Vælges dette flyttes målingerne til arkiv-mappen i en mappe, der svarer til 
datoen for kørslen af programmet. Ellers lader programmet filerne ligge.


\section*{Matematisk baggrund}

Til beregning af den målte aktivitet er der to usikkerheder, som \radex{} 
holder styr på: usikkerheden på følsomheden samt usikkerheden forbundet med 
tællestatistikken.

Usikkerheden på følsomheden kommer fra, at vi har et antal målinger foretaget 
på kilder, der har en kendt aktivitet. Lad den baggrundskorrigerede tællerate 
på hver måling være $R_i$ og aktiviteten på kilden være $A_i$ (antaget uden 
usikkerhed), hvor $i=1,\ldots,N$. Vores estimater for følsomheden er så 
$\kappa_i = R_i/A_i$, og middelværdien er
\begin{equation}
	\overline{\kappa} = \frac{1}{N}\sum_{i=1}^N \kappa_i .
\end{equation}
Vi beregner standardfejlen på $\overline{\kappa}$ ud fra en antagelse om, at 
$\kappa_i$ er normalfordelt. Hvis den antagelse holder fås usikkerheden på 
$\overline{\kappa}$ til 
\begin{equation}
	\sigma_{\overline{\kappa}} = \frac{s_\kappa}{\sqrt{N}},
\end{equation}
hvor $s_\kappa$ er et estimat for standardafvigelsen
\begin{equation}
	s_\kappa = \sqrt{\frac{\sum_{i=1}^N \left( \kappa_i - \overline{\kappa} 
	\right)^2}{N-1}} .
\end{equation} 
Estimaterne $\kappa_i$ vil ikke være eksakt normalfordelte, og en direkte 
simulering viser, at standardfejlen typisk er undervurderet for små tælletal og 
overvurderet for store tælletal.


Den tællestatistiske baggrund for programmet er taget fra ref. 
\cite{currie1968}, og er kort summeret her.

Den primære data vi arbejder med er tælletal (counts), som med kendt måletid og 
følsomhed nemt kan omsættes til en aktivitet. Vi ignorerer usikkerheden på 
begge disse to omsætningsparametre. Der er tre tælletal, vi skal holde styr på: 
Baggrunden $B$, signalet $S$ og det totale tælletal $G = B + S$. Vi kan måle 
$B$ og $G$, men $S = G - B$ kan ikke måles direkte.

Vi antager, at tælletallene er Poisson-fordelte, altså at $B$ kan tænkes som et 
tilfældigt tal trukket fra en Poissonfordeling med middelværdi og varians 
$\mu_B$, og ligeledes for $G$ og $S$. Dermed vil den estimerede 
standardafvigelse på baggrunden være $\sigma_B = \sqrt{B}$, mens den estimerede 
standardafvigelse på signalet er $\sigma_S = \sqrt{B + G}$.

Spørgsmålet, som ref. \cite{currie1968} forsøger at besvare er, hvornår vi kan 
sige at et givet signal $S$ er lig med en detektion og hvor stor usikkerhed vi 
skal give til målingen. I den forbindelse fastsætter vi to grænser: Den første 
er det kritiske niveau $L_C$. Hvis $S > L_C$ vil vi sige, at vi har observeret 
et signal, der ikke blot er et udsving i baggrunden. Den anden grænse er 
detektionsgrænsen $L_D$. Den angiver, hvor stort et tælletal en kilde skal 
have, før vi \emph{a priori} kan forvente at observere et signal, der er større 
end $L_C$.

Med til disse grænser hører et valg om, hvor stor tolerance vi vil tillade for 
at lave fejl af type I ($\alpha$, falsk positiv) og type II ($\beta$, falsk 
negativ). \radex{} sætter $\alpha = \beta = 0.05$. De to grænser kan så 
beregnes med formlerne

\begin{align}
	L_C &= k_\alpha \sqrt{2B}, \\
	L_D &= L_C + \frac{k_\beta^2}{2} \left( 1 + \sqrt{ 1 + 
	\frac{4L_C}{k_\beta^2} + \frac{4L_C^2}{k_\alpha^2 k_\beta^2} } \right),
\end{align}
hvor $k_\alpha$ og $k_\beta$ er abscissen i en standard normalfordeling 
svarende til sandsynlighedsniveauet $1-\alpha$ og $1-\beta$ henholdsvis.

Når et resultat vises for brugeren rapporteres det målte signal i aktivitet, 
hvorfor både usikkerheden på følsomheden og usikkerheden fra tællestatistikken 
spiller ind.
Aktiviteten er
\begin{equation}
	A = \frac{S/t}{\kappa},
\end{equation}
hvor $t$ er måletiden, som antages at være uden usikkerhed. Fra propagering af 
usikkerheder fås usikkerheden på aktiviteten til
\begin{equation}
	\sigma_A = \frac{1}{\kappa} \sqrt{\frac{\sigma_S^2}{t^2} + A^2 
	\sigma_{\overline{\kappa}}^2}
\end{equation}

Hvis $S > L_C$ angives et observeret signal af værdien $A \pm 
z_{1-\gamma/2}\sigma_A$, hvor $z_{1-\gamma/2}$ er den kritiske værdi på en 
standard normalfordeling svarende til et sandsynlighedsniveau på $1 - \gamma/2$.

Hvis i stedet $S \leq L_C$ angives intet signal, og der rapporteres en øvre 
grænse på den sande værdi af signalet på $A + z_{1-\gamma} \sigma_A$. Bemærk 
her det ensidede konfidensinterval ($1-\gamma$ i stedet for $1-\gamma/2$), da 
vi kun rapporterer en øvre grænse.

I \radex{} er $\gamma$ sat til $0.05$ som udgangspunkt.


\bibliographystyle{JHEP}
\bibliography{radex}


\end{document}
